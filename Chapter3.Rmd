---
title: "Chapter3"
author: "Julin N Maloof"
date: "4/18/2019"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rethinking)
```

## Easy

```{r}
p_grid <- seq( from=0 , to=1 , length.out=1000 )
prior <- rep( 1 , 1000 )
likelihood <- dbinom( 6 , size=9 , prob=p_grid )
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
set.seed(100)
samples <- sample( p_grid , prob=posterior , size=1e4 , replace=TRUE )
```


```{r}
hist(samples)
```



### 3E1. 
_How much posterior probability lies below p = 0.2?_

```{r}
sum(samples < .2) / length(samples)
```

### 3E2. 
_How much posterior probability lies above p = 0.8?_

```{r}
sum(samples > 0.8) / length(samples)
```

### 3E3. 
_How much posterior probability lies between p = 0.2 and p = 0.8?_

```{r}
sum(samples >0.2 & samples < 0.8) / length(samples)
```

### 3E4. 
_20% of the posterior probability lies below which value of p?_

```{r}
quantile(samples, 0.2)
```


### 3E5. 
_20% of the posterior probability lies above which value of p?_

```{r}
quantile(samples, 0.8)
```


### 3E6. 
_Which values of p contain the narrowest interval equal to 66% of the posterior probability?_

```{r}
HPDI(samples, 0.66)
```


### 3E7. 
_Which values of p contain 66% of the posterior probability, assuming equal posterior probability both below and above the interval?_

```{r}
PI(samples, 0.66)
```

## Medium

### 3M1. 
_Suppose the globe tossing data had turned out to be 8 water in 15 tosses. Construct the posterior distribution, using grid approximation. Use the same flat prior as before._

```{r}
p_grid <- seq(0,1, length.out = 1000)
prior <- rep(1,length(p_grid))
likelihood <- dbinom(8, 15, prob = p_grid)
plot(likelihood)
unstd.post <- prior*likelihood
post <- unstd.post / sum(unstd.post)
plot(post)
```


### 3M2. 
_Draw 10,000 samples from the grid approximation from above. Then use the samples to calculate the 90% HPDI for p._

```{r}
samples <- sample(p_grid, size = 10000, replace = TRUE, prob = post)
hist(samples)
HPDI(samples, 0.9)
```


### 3M3. 
_Construct a posterior predictive check for this model and data. This means simulate the distribution of samples, averaging over the posterior uncertainty in p. What is the probability of observing 8 water in 15 tosses?_

```{r}
predictions <- rbinom(10000, 15, prob = samples)
sum(predictions==8) / length(predictions)
```


### 3M4. 
_Using the posterior distribution constructed from the new (8/15) data, now calculate the probability of observing 6 water in 9 tosses._

```{r}
predictions9 <- rbinom(10000, 9, prob = samples)
sum(predictions9==6) / length(predictions9)

```


### 3M5.
_Start over at 3M1, but now use a prior that is zero below p = 0:5 and a constant above p = 0:5. This corresponds to prior information that a majority of the Earthâ€™s surface is water. Repeat each problem above and compare the inferences. What difference does the better prior make? If it helps,
compare inferences (using both priors) to the true value p = 0:7._

```{r}
p_grid <- seq(0,1, length.out = 1000)
prior <- rep(1,length(p_grid)) %>% ifelse(p_grid < .5, 0, .)
likelihood <- dbinom(8, 15, prob = p_grid)
plot(likelihood)
unstd.post <- prior*likelihood
post <- unstd.post / sum(unstd.post)
plot(post)
```


_Draw 10,000 samples from the grid approximation from above. Then use the samples to calculate the 90% HPDI for p._

```{r}
samples2 <- sample(p_grid, size = 10000, replace = TRUE, prob = post)
hist(samples2)
HPDI(samples2, 0.9)
```

Confidence intervals are tighter
